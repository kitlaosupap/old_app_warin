<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>แอปบันทึกข้อมูลผู้สูงอายุ</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Sarabun', sans-serif;
        }
        
        .tab-button {
            transition: all 0.3s ease;
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .form-input {
            transition: all 0.2s ease;
        }
        
        .form-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .hidden {
            display: none;
        }
        
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        @media (max-width: 768px) {
            .mobile-responsive {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="max-w-6xl mx-auto p-4 lg:p-6 bg-white min-h-screen">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-2xl lg:text-3xl font-bold text-gray-800 mb-2">
                แอปบันทึกข้อมูลผู้สูงอายุที่อยู่ลำพัง
            </h1>
            <p class="text-gray-600">ระบบบันทึกและประเมินคุณภาพชีวิตผู้สูงอายุ</p>
        </div>

        <!-- Tab Navigation -->
        <div class="flex flex-col lg:flex-row space-y-2 lg:space-y-0 lg:space-x-4 mb-8 justify-center">
            <button id="tab1-btn" class="tab-button active flex items-center justify-center space-x-2 px-4 py-3 rounded-lg font-medium">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
                <span>ข้อมูลส่วนบุคคล</span>
            </button>
            <button id="tab2-btn" class="tab-button flex items-center justify-center space-x-2 px-4 py-3 rounded-lg font-medium bg-gray-100 text-gray-700">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                <span>แบบประเมิน QOL</span>
            </button>
            <button id="tab3-btn" class="tab-button flex items-center justify-center space-x-2 px-4 py-3 rounded-lg font-medium bg-gray-100 text-gray-700">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
                <span>รายงานผล</span>
            </button>
        </div>

        <!-- Tab Content -->
        
        <!-- Tab 1: Personal Data -->
        <div id="tab1-content" class="tab-content bg-white border border-gray-200 rounded-lg p-4 lg:p-6">
            <h2 class="text-xl lg:text-2xl font-semibold text-gray-800 mb-6 flex items-center">
                <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
                ข้อมูลส่วนบุคคล
            </h2>
            
            <div class="space-y-6">
                <!-- Basic Info -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            ชื่อ <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="firstName" class="form-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none">
                    </div>
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            นามสกุล <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="lastName" class="form-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none">
                    </div>
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            เพศ <span class="text-red-500">*</span>
                        </label>
                        <select id="gender" class="form-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none">
                            <option value="">เลือก...</option>
                            <option value="ชาย">ชาย</option>
                            <option value="หญิง">หญิง</option>
                        </select>
                    </div>
                </div>

                <!-- Birth Date -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">วันเกิด</label>
                        <select id="birthDay" class="form-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none">
                            <option value="">เลือกวัน</option>
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">เดือนเกิด</label>
                        <select id="birthMonth" class="form-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none">
                            <option value="">เลือกเดือน</option>
                            <option value="มกราคม">มกราคม</option>
                            <option value="กุมภาพันธ์">กุมภาพันธ์</option>
                            <option value="มีนาคม">มีนาคม</option>
                            <option value="เมษายน">เมษายน</option>
                            <option value="พฤษภาคม">พฤษภาคม</option>
                            <option value="มิถุนายน">มิถุนายน</option>
                            <option value="กรกฎาคม">กรกฎาคม</option>
                            <option value="สิงหาคม">สิงหาคม</option>
                            <option value="กันยายน">กันยายน</option>
                            <option value="ตุลาคม">ตุลาคม</option>
                            <option value="พฤศจิกายน">พฤศจิกายน</option>
                            <option value="ธันวาคม">ธันวาคม</option>
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">ปีเกิด (พ.ศ.)</label>
                        <select id="birthYear" class="form-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none">
                            <option value="">เลือกปี</option>
                        </select>
                    </div>
                </div>

                <!-- Address -->
                <div class="space-y-4">
                    <h3 class="text-lg font-medium text-gray-800 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        ที่อยู่
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">จังหวัด</label>
                            <select id="province" class="form-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none">
                                <option value="">เลือก...</option>
                                <option value="กรุงเทพมหานคร">กรุงเทพมหานคร</option>
                                <option value="อุบลราชธานี">อุบลราชธานี</option>
                                <option value="เชียงใหม่">เชียงใหม่</option>
                            </select>
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">อำเภอ/เขต</label>
                            <select id="district" class="form-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none">
                                <option value="">เลือก...</option>
                            </select>
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">ตำบล/แขวง</label>
                            <select id="subdistrict" class="form-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none">
                                <option value="">เลือก...</option>
                            </select>
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">หมู่บ้าน/ชุมชน</label>
                            <select id="village" class="form-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none">
                                <option value="">เลือก...</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Living Arrangement -->
                <div class="space-y-4">
                    <h3 class="text-lg font-medium text-gray-800 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                        ข้อมูลการอยู่อาศัยและสังคม
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">ลักษณะการอยู่อาศัย</label>
                            <select id="livingArrangement" class="form-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none">
                                <option value="">เลือก...</option>
                                <option value="อยู่ลำพัง">อยู่ลำพัง</option>
                                <option value="อยู่กับญาติ">อยู่กับญาติ</option>
                                <option value="อยู่กับเด็ก">อยู่กับเด็ก</option>
                                <option value="อยู่กับคู่สมรส">อยู่กับคู่สมรส</option>
                                <option value="อยู่กับผู้พิการ">อยู่กับผู้พิการ</option>
                            </select>
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">ภาวะพึ่งพิง</label>
                            <select id="dependency" class="form-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none">
                                <option value="">เลือก...</option>
                                <option value="ติดบ้าน">ติดบ้าน</option>
                                <option value="ติดเตียง">ติดเตียง</option>
                                <option value="ติดสังคม">ติดสังคม</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Income and Distance -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">รายได้เฉลี่ยต่อเดือน (บาท)</label>
                        <input type="number" id="monthlyIncome" class="form-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none" placeholder="0">
                    </div>
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">ระยะทางจากบ้านถึงสถานบริการ (กม.)</label>
                        <input type="number" id="distanceToService" class="form-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none" placeholder="0">
                    </div>
                </div>

                <!-- Memberships -->
                <div class="space-y-4">
                    <h3 class="text-lg font-medium text-gray-800 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        การเป็นสมาชิก
                    </h3>
                    <div class="space-y-3">
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" id="elderlyClub" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                            <span class="text-sm text-gray-700">ชมรมผู้สูงอายุ</span>
                        </label>
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" id="elderlySchool" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                            <span class="text-sm text-gray-700">โรงเรียนผู้สูงอายุ</span>
                        </label>
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" id="nhsoGroup" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                            <span class="text-sm text-gray-700">กลุ่ม ญกส.</span>
                        </label>
                        <div class="space-y-2">
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="otherMembership" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                                <span class="text-sm text-gray-700">อื่นๆ</span>
                            </label>
                            <div id="otherMembershipDetail" class="hidden">
                                <input type="text" id="otherDetail" class="form-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none" placeholder="โปรดระบุ...">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab 2: QOL Assessment -->
        <div id="tab2-content" class="tab-content hidden bg-white border border-gray-200 rounded-lg p-4 lg:p-6">
            <h2 class="text-xl lg:text-2xl font-semibold text-gray-800 mb-6 flex items-center">
                <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                แบบประเมิน QOL Thai BREF (26 ข้อ)
            </h2>
            
            <div id="qol-questions" class="space-y-6"></div>
            
            <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                <p id="qol-progress" class="text-sm text-blue-800">
                    ความคืบหน้า: 0 / 26 ข้อ
                </p>
            </div>
        </div>

        <!-- Tab 3: Report -->
        <div id="tab3-content" class="tab-content hidden bg-white border border-gray-200 rounded-lg p-4 lg:p-6">
            <h2 class="text-xl lg:text-2xl font-semibold text-gray-800 mb-6 flex items-center">
                <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
                รายงานผล
            </h2>

            <div id="report-content">
                <!-- Report content will be generated here -->
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let personalData = {};
        let qolData = {};
        
        // Location data
        const locationData = {
            'กรุงเทพมหานคร': {
                'เขตบางรัก': {
                    'แขวงสีลม': ['ชุมชนสีลม', 'ชุมชนสาทร'],
                    'แขวงสุริยวงศ์': ['ชุมชนสุริยวงศ์', 'ชุมชนบางรัก']
                },
                'เขตดุสิต': {
                    'แขวงดุสิต': ['ชุมชนดุสิต', 'ชุมชนวชิรพยาบาล'],
                    'แขวงสวนจิตรลดา': ['ชุมชนสวนจิตรลดา']
                }
            },
            'อุบลราชธานี': {
                'อำเภอเมืองอุบลราชธานี': {
                    'ตำบลในเมือง': ['หมู่ 1', 'หมู่ 2', 'หมู่ 3'],
                    'ตำบลแจระแม': ['หมู่ 1', 'หมู่ 2']
                },
                'อำเภอวารินชำราบ': {
                    'ตำบลวารินชำราบ': ['หมู่ 1', 'หมู่ 2', 'หมู่ 3'],
                    'ตำบลบุ่งมะลัง': ['หมู่ 1', 'หมู่ 2']
                }
            },
            'เชียงใหม่': {
                'อำเภอเมืองเชียงใหม่': {
                    'ตำบลศรีภูมิ': ['หมู่ 1', 'หมู่ 2'],
                    'ตำบลช้างคลาน': ['หมู่ 1', 'หมู่ 2']
                }
            }
        };

        // QOL questions
        const qolQuestions = [
            "โดยรวมแล้วท่านประเมินคุณภาพชีวิตของท่านอย่างไร",
            "โดยรวมแล้วท่านพอใจกับสุขภาพของท่านมากน้อยเพียงใด",
            "ท่านรู้สึกว่าความเจ็บปวด(ทางร่างกาย)ขัดขวางท่านจากการทำในสิ่งที่ต้องการทำมากน้อยเพียงใด",
            "ท่านต้องการการรักษาพยาบาลเพื่อใช้ชีวิตประจำวันมากน้อยเพียงใด",
            "ท่านเพลิดเพลินกับชีวิตมากน้อยเพียงใด",
            "ท่านรู้สึกว่าชีวิตของท่านมีความหมายมากน้อยเพียงใด",
            "ท่านสามารถมีสมาธิได้มากน้อยเพียงใด",
            "ท่านรู้สึกปลอดภัยในชีวิตประจำวันมากน้อยเพียงใด",
            "สภาพแวดล้อมทางกายภาพ(อากาศ เสียงรบกวน มลพิษ สภาพอากาศ)ของท่านดีต่อสุขภาพมากน้อยเพียงใด",
            "ท่านมีพลังงานเพียงพอสำหรับชีวิตประจำวันมากน้อยเพียงใด",
            "ท่านยอมรับรูปร่างหน้าตาของตัวเองได้มากน้อยเพียงใด",
            "ท่านมีเงินเพียงพอสำหรับความต้องการมากน้อยเพียงใด",
            "ข้อมูลข่าวสารที่ท่านต้องการในชีวิตประจำวันหาได้ง่ายมากน้อยเพียงใด",
            "ท่านมีโอกาสทำกิจกรรมเพื่อการพักผ่อนมากน้อยเพียงใด",
            "ท่านเดินทางไปมาได้ดีมากน้อยเพียงใด",
            "ท่านพอใจกับการนอนหลับมากน้อยเพียงใด",
            "ท่านพอใจกับความสามารถในการทำกิจกรรมประจำวันมากน้อยเพียงใด",
            "ท่านพอใจกับความสามารถในการทำงานมากน้อยเพียงใด",
            "ท่านพอใจในตัวเองมากน้อยเพียงใด",
            "ท่านพอใจกับความสัมพันธ์ส่วนตัวมากน้อยเพียงใด",
            "ท่านพอใจกับชีวิตทางเพศมากน้อยเพียงใด",
            "ท่านพอใจกับการสนับสนุนที่ได้รับจากเพื่อนมากน้อยเพียงใด",
            "ท่านพอใจกับสภาพของที่อยู่อาศัยมากน้อยเพียงใด",
            "ท่านเข้าถึงบริการสุขภาพได้ง่ายมากน้อยเพียงใด",
            "ท่านพอใจกับการเดินทางไปมามากน้อยเพียงใด",
            "ท่านมีความรู้สึกเศร้า ท้อแท้ วิตกกังวล หรือหดหู่มากน้อยเพียงใด"
        ];

        const scaleOptions = [
            { value: 1, label: "น้อยที่สุด" },
            { value: 2, label: "น้อย" },
            { value: 3, label: "ปานกลาง" },
            { value: 4, label: "มาก" },
            { value: 5, label: "มากที่สุด" }
        ];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeBirthOptions();
            initializeQolQuestions();
            setupEventListeners();
            loadSavedData();
        });

        // Initialize birth date options
        function initializeBirthOptions() {
            const daySelect = document.getElementById('birthDay');
            const yearSelect = document.getElementById('birthYear');
            
            // Days 1-31
            for (let i = 1; i <= 31; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                daySelect.appendChild(option);
            }
            
            // Years (current year - 50 to current year - 120)
            const currentYear = new Date().getFullYear();
            const buddhiYear = currentYear + 543;
            for (let i = buddhiYear - 50; i >= buddhiYear - 120; i--) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                yearSelect.appendChild(option);
            }
        }

        // Initialize QOL questions
        function initializeQolQuestions() {
            const container = document.getElementById('qol-questions');
            container.innerHTML = '';
            
            qolQuestions.forEach((question, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'border-b border-gray-200 pb-4';
                
                questionDiv.innerHTML = `
                    <div class="mb-3">
                        <span class="text-sm font-medium text-gray-500">ข้อ ${index + 1}</span>
                        <p class="text-gray-800 mt-1">${question}</p>
                    </div>
                    <div class="flex flex-wrap gap-4">
                        ${scaleOptions.map(option => `
                            <label class="flex items-center space-x-2">
                                <input type="radio" name="question-${index + 1}" value="${option.value}" 
                                       onchange="updateQolData(${index + 1}, ${option.value})"
                                       class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500">
                                <span class="text-sm text-gray-700">${option.value} - ${option.label}</span>
                            </label>
                        `).join('')}
                    </div>
                `;
                
                container.appendChild(questionDiv);
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Tab navigation
            document.getElementById('tab1-btn').addEventListener('click', () => switchTab(1));
            document.getElementById('tab2-btn').addEventListener('click', () => switchTab(2));
            document.getElementById('tab3-btn').addEventListener('click', () => switchTab(3));

            // Personal data inputs
            const personalInputs = [
                'firstName', 'lastName', 'gender', 'birthDay', 'birthMonth', 'birthYear',
                'province', 'district', 'subdistrict', 'village',
                'livingArrangement', 'dependency', 'monthlyIncome', 'distanceToService'
            ];

            personalInputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', savePersonalData);
                }
            });

            // Location cascade
            document.getElementById('province').addEventListener('change', updateDistricts);
            document.getElementById('district').addEventListener('change', updateSubdistricts);
            document.getElementById('subdistrict').addEventListener('change', updateVillages);

            // Membership checkboxes
            const checkboxes = ['elderlyClub', 'elderlySchool', 'nhsoGroup', 'otherMembership'];
            checkboxes.forEach(id => {
                document.getElementById(id).addEventListener('change', savePersonalData);
            });

            document.getElementById('otherMembership').addEventListener('change', function() {
                const detailDiv = document.getElementById('otherMembershipDetail');
                if (this.checked) {
                    detailDiv.classList.remove('hidden');
                } else {
                    detailDiv.classList.add('hidden');
                    document.getElementById('otherDetail').value = '';
                }
                savePersonalData();
            });

            document.getElementById('otherDetail').addEventListener('input', savePersonalData);
        }

        // Switch tabs
        function switchTab(tabNum) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.add('bg-gray-100', 'text-gray-700');
                btn.classList.remove('bg-blue-600', 'text-white');
            });

            // Show selected tab content
            document.getElementById(`tab${tabNum}-content`).classList.remove('hidden');

            // Add active class to selected button
            const activeBtn = document.getElementById(`tab${tabNum}-btn`);
            activeBtn.classList.add('active');
            activeBtn.classList.remove('bg-gray-100', 'text-gray-700');
            activeBtn.classList.add('bg-blue-600', 'text-white');

            // Generate report if tab 3 is selected
            if (tabNum === 3) {
                generateReport();
            }
        }

        // Update location dropdowns
        function updateDistricts() {
            const province = document.getElementById('province').value;
            const districtSelect = document.getElementById('district');
            const subdistrictSelect = document.getElementById('subdistrict');
            const villageSelect = document.getElementById('village');

            // Clear dependent dropdowns
            districtSelect.innerHTML = '<option value="">เลือก...</option>';
            subdistrictSelect.innerHTML = '<option value="">เลือก...</option>';
            villageSelect.innerHTML = '<option value="">เลือก...</option>';

            if (province && locationData[province]) {
                Object.keys(locationData[province]).forEach(district => {
                    const option = document.createElement('option');
                    option.value = district;
                    option.textContent = district;
                    districtSelect.appendChild(option);
                });
            }
            savePersonalData();
        }

        function updateSubdistricts() {
            const province = document.getElementById('province').value;
            const district = document.getElementById('district').value;
            const subdistrictSelect = document.getElementById('subdistrict');
            const villageSelect = document.getElementById('village');

            // Clear dependent dropdowns
            subdistrictSelect.innerHTML = '<option value="">เลือก...</option>';
            villageSelect.innerHTML = '<option value="">เลือก...</option>';

            if (province && district && locationData[province] && locationData[province][district]) {
                Object.keys(locationData[province][district]).forEach(subdistrict => {
                    const option = document.createElement('option');
                    option.value = subdistrict;
                    option.textContent = subdistrict;
                    subdistrictSelect.appendChild(option);
                });
            }
            savePersonalData();
        }

        function updateVillages() {
            const province = document.getElementById('province').value;
            const district = document.getElementById('district').value;
            const subdistrict = document.getElementById('subdistrict').value;
            const villageSelect = document.getElementById('village');

            villageSelect.innerHTML = '<option value="">เลือก...</option>';

            if (province && district && subdistrict && 
                locationData[province] && 
                locationData[province][district] && 
                locationData[province][district][subdistrict]) {
                
                locationData[province][district][subdistrict].forEach(village => {
                    const option = document.createElement('option');
                    option.value = village;
                    option.textContent = village;
                    villageSelect.appendChild(option);
                });
            }
            savePersonalData();
        }

        // Save personal data
        function savePersonalData() {
            const data = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                gender: document.getElementById('gender').value,
                birthDay: document.getElementById('birthDay').value,
                birthMonth: document.getElementById('birthMonth').value,
                birthYear: document.getElementById('birthYear').value,
                province: document.getElementById('province').value,
                district: document.getElementById('district').value,
                subdistrict: document.getElementById('subdistrict').value,
                village: document.getElementById('village').value,
                livingArrangement: document.getElementById('livingArrangement').value,
                dependency: document.getElementById('dependency').value,
                monthlyIncome: document.getElementById('monthlyIncome').value,
                distanceToService: document.getElementById('distanceToService').value,
                memberships: {
                    elderlyClub: document.getElementById('elderlyClub').checked,
                    elderlySchool: document.getElementById('elderlySchool').checked,
                    nhsoGroup: document.getElementById('nhsoGroup').checked,
                    other: document.getElementById('otherMembership').checked,
                    otherDetail: document.getElementById('otherDetail').value
                }
            };

            personalData = data;
            localStorage.setItem('elderlyPersonalData', JSON.stringify(data));
        }

        // Update QOL data
        function updateQolData(questionId, value) {
            qolData[questionId] = parseInt(value);
            localStorage.setItem('elderlyQolData', JSON.stringify(qolData));
            updateQolProgress();
        }

        // Update QOL progress
        function updateQolProgress() {
            const progress = document.getElementById('qol-progress');
            const completed = Object.keys(qolData).length;
            progress.textContent = `ความคืบหน้า: ${completed} / 26 ข้อ`;
        }

        // Calculate QOL score
        function calculateQolScore() {
            const scores = Object.values(qolData);
            if (scores.length === 0) return 0;
            const total = scores.reduce((sum, score) => sum + score, 0);
            return (total / scores.length).toFixed(2);
        }

        // Generate report
        function generateReport() {
            const reportContainer = document.getElementById('report-content');
            const qolScore = calculateQolScore();
            const completedQuestions = Object.keys(qolData).length;
            
            let reportHTML = `
                <!-- Personal Data Summary -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">ข้อมูลส่วนบุคคล</h3>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div><strong>ชื่อ-นามสกุล:</strong> ${personalData.firstName || ''} ${personalData.lastName || ''}</div>
                            <div><strong>เพศ:</strong> ${personalData.gender || 'ไม่ระบุ'}</div>
                            <div><strong>วันเกิด:</strong> ${personalData.birthDay || ''} ${personalData.birthMonth || ''} ${personalData.birthYear || ''}</div>
                            <div><strong>ที่อยู่:</strong> ${personalData.village || ''} ${personalData.subdistrict || ''} ${personalData.district || ''} ${personalData.province || ''}</div>
                            <div><strong>ลักษณะการอยู่อาศัย:</strong> ${personalData.livingArrangement || 'ไม่ระบุ'}</div>
                            <div><strong>ภาวะพึ่งพิง:</strong> ${personalData.dependency || 'ไม่ระบุ'}</div>
                            <div><strong>รายได้ต่อเดือน:</strong> ${personalData.monthlyIncome || 'ไม่ระบุ'} บาท</div>
                            <div><strong>ระยะทางถึงสถานบริการ:</strong> ${personalData.distanceToService || 'ไม่ระบุ'} กม.</div>
                        </div>
                        
                        <div class="mt-4">
                            <strong>การเป็นสมาชิก:</strong>
                            <ul class="list-disc list-inside mt-2 text-sm">
            `;

            if (personalData.memberships) {
                if (personalData.memberships.elderlyClub) reportHTML += '<li>ชมรมผู้สูงอายุ</li>';
                if (personalData.memberships.elderlySchool) reportHTML += '<li>โรงเรียนผู้สูงอายุ</li>';
                if (personalData.memberships.nhsoGroup) reportHTML += '<li>กลุ่ม ญกส.</li>';
                if (personalData.memberships.other && personalData.memberships.otherDetail) {
                    reportHTML += `<li>อื่นๆ: ${personalData.memberships.otherDetail}</li>`;
                }
            }

            reportHTML += `
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- QOL Results -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">ผลการประเมิน QOL Thai BREF</h3>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                            <div class="bg-white p-4 rounded-lg">
                                <div class="text-2xl font-bold text-blue-600">${completedQuestions}</div>
                                <div class="text-sm text-gray-600">ข้อที่ตอบแล้ว</div>
                            </div>
                            <div class="bg-white p-4 rounded-lg">
                                <div class="text-2xl font-bold text-green-600">${qolScore}</div>
                                <div class="text-sm text-gray-600">คะแนนเฉลี่ย</div>
                            </div>
                            <div class="bg-white p-4 rounded-lg">
                                <div class="text-2xl font-bold text-purple-600">
                                    ${completedQuestions === 26 ? 'สมบูรณ์' : 'ไม่สมบูรณ์'}
                                </div>
                                <div class="text-sm text-gray-600">สถานะการประเมิน</div>
                            </div>
                        </div>
                        
                        <div class="mt-6">
                            <h4 class="font-semibold text-gray-800 mb-3">การแปลผล</h4>
                            <div class="text-sm text-gray-700">
            `;

            if (completedQuestions === 26) {
                const level = qolScore >= 3.68 ? 'สูง' : qolScore >= 2.34 ? 'ปานกลาง' : 'ต่ำ';
                const levelClass = qolScore >= 3.68 ? 'bg-green-200 text-green-800' : 
                                 qolScore >= 2.34 ? 'bg-yellow-200 text-yellow-800' : 'bg-red-200 text-red-800';
                
                reportHTML += `
                                <p class="mb-2"><strong>คะแนนเฉลี่ย:</strong> ${qolScore} จาก 5 คะแนน</p>
                                <p class="mb-2"><strong>การแปลผล:</strong></p>
                                <ul class="list-disc list-inside space-y-1">
                                    <li>1.00 - 2.33: คุณภาพชีวิตอยู่ในระดับต่ำ</li>
                                    <li>2.34 - 3.67: คุณภาพชีวิตอยู่ในระดับปานกลาง</li>
                                    <li>3.68 - 5.00: คุณภาพชีวิตอยู่ในระดับสูง</li>
                                </ul>
                                <div class="mt-4 p-3 bg-blue-100 rounded-lg">
                                    <strong>ระดับคุณภาพชีวิต:</strong>
                                    <span class="ml-2 px-3 py-1 rounded-full text-sm font-medium ${levelClass}">
                                        ${level}
                                    </span>
                                </div>
                `;
            } else {
                reportHTML += '<p class="text-orange-600">โปรดทำแบบประเมินให้ครบถ้วนเพื่อดูผลการวิเคราะห์</p>';
            }

            reportHTML += `
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Summary and Recommendations -->
                <div>
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">สรุปและข้อเสนอแนะ</h3>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2">สรุปสถานะผู้สูงอายุ</h4>
                                <ul class="list-disc list-inside text-sm text-gray-700 space-y-1">
                                    <li>ผู้สูงอายุ${personalData.gender || ''}ที่มีลักษณะการอยู่อาศัยแบบ${personalData.livingArrangement || 'ไม่ระบุ'}${personalData.dependency ? ` มีภาวะ${personalData.dependency}` : ''}</li>
                                    <li>มีรายได้เฉลี่ย ${personalData.monthlyIncome || 'ไม่ระบุ'} บาทต่อเดือน</li>
                                    <li>อยู่ห่างจากสถานบริการ ${personalData.distanceToService || 'ไม่ระบุ'} กิลอเมตร</li>
            `;

            if (completedQuestions === 26) {
                const level = qolScore >= 3.68 ? 'สูง' : qolScore >= 2.34 ? 'ปานกลาง' : 'ต่ำ';
                reportHTML += `<li>มีคะแนนคุณภาพชีวิตเฉลี่ย ${qolScore} คะแนน อยู่ในระดับ${level}</li>`;
            }

            reportHTML += `
                                </ul>
                            </div>

                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2">ข้อเสนอแนะ</h4>
                                <ul class="list-disc list-inside text-sm text-gray-700 space-y-1">
            `;

            // Generate recommendations
            if (personalData.livingArrangement === 'อยู่ลำพัง') {
                reportHTML += '<li>ควรให้การดูแลและติดตามอย่างใกล้ชิด เนื่องจากอยู่ลำพัง</li>';
            }
            
            if (personalData.dependency) {
                reportHTML += `<li>ต้องการการสนับสนุนเพิ่มเติมเนื่องจากมีภาวะ${personalData.dependency}</li>`;
            }
            
            if (parseFloat(personalData.distanceToService) > 10) {
                reportHTML += '<li>ควรพิจารณาการจัดบริการเคลื่อนที่ เนื่องจากอยู่ห่างจากสถานบริการ</li>';
            }
            
            if (completedQuestions === 26 && qolScore < 2.34) {
                reportHTML += '<li>ควรได้รับการดูแลเป็นพิเศษ เนื่องจากคุณภาพชีวิตอยู่ในระดับต่ำ</li>';
            }
            
            if (personalData.memberships && 
                !personalData.memberships.elderlyClub && 
                !personalData.memberships.elderlySchool && 
                !personalData.memberships.nhsoGroup && 
                !personalData.memberships.other) {
                reportHTML += '<li>ควรสนับสนุนให้เข้าร่วมกิจกรรมทางสังคมเพื่อสร้างเครือข่ายสนับสนุน</li>';
            }

            reportHTML += `
                                </ul>
                            </div>

                            <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                                <p class="text-sm text-blue-800 font-medium">
                                    หมายเหตุ: รายงานนี้เป็นข้อมูลเบื้องต้นสำหรับการวางแผนการดูแลผู้สูงอายุ 
                                    ควรใช้ร่วมกับการประเมินจากผู้เชี่ยวชาญเพื่อให้ได้แผนการดูแลที่เหมาะสมที่สุด
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            reportContainer.innerHTML = reportHTML;
        }

        // Load saved data
        function loadSavedData() {
            const savedPersonalData = localStorage.getItem('elderlyPersonalData');
            const savedQolData = localStorage.getItem('elderlyQolData');

            if (savedPersonalData) {
                personalData = JSON.parse(savedPersonalData);
                
                // Populate form fields
                Object.keys(personalData).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = personalData[key];
                        } else {
                            element.value = personalData[key];
                        }
                    }
                });

                // Handle memberships
                if (personalData.memberships) {
                    Object.keys(personalData.memberships).forEach(key => {
                        const element = document.getElementById(key);
                        if (element && element.type === 'checkbox') {
                            element.checked = personalData.memberships[key];
                        } else if (key === 'otherDetail') {
                            const otherDetailElement = document.getElementById('otherDetail');
                            if (otherDetailElement) {
                                otherDetailElement.value = personalData.memberships[key];
                            }
                        }
                    });

                    // Show other detail field if needed
                    if (personalData.memberships.other) {
                        document.getElementById('otherMembershipDetail').classList.remove('hidden');
                    }
                }

                // Update location dropdowns
                if (personalData.province) {
                    updateDistricts();
                    setTimeout(() => {
                        if (personalData.district) {
                            document.getElementById('district').value = personalData.district;
                            updateSubdistricts();
                            setTimeout(() => {
                                if (personalData.subdistrict) {
                                    document.getElementById('subdistrict').value = personalData.subdistrict;
                                    updateVillages();
                                    setTimeout(() => {
                                        if (personalData.village) {
                                            document.getElementById('village').value = personalData.village;
                                        }
                                    }, 100);
                                }
                            }, 100);
                        }
                    }, 100);
                }
            }

            if (savedQolData) {
                qolData = JSON.parse(savedQolData);
                
                // Restore QOL answers
                Object.keys(qolData).forEach(questionId => {
                    const radioButton = document.querySelector(`input[name="question-${questionId}"][value="${qolData[questionId]}"]`);
                    if (radioButton) {
                        radioButton.checked = true;
                    }
                });

                updateQolProgress();
            }
        }
    </script>
</body>
</html>
            "